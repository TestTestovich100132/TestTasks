# Баг Репорт

#### ID: BR-001

#### Название:
Сбой оболочки при отключении NFS ресурса

## Описание проблемы
При отключении NFS ресурса на сервере, если клиент находится в примонтированной директории этого ресурса и пытается выйти из нее, оболочка падает и перестает отвечать. Закрытие оболочки стандартным способом (например, через крестик) невозможно, и процесс можно завершить только через PID. Более того, любые попытки взаимодействия с монтированным каталогом приводят к зависанию новых терминалов.

## Предворительная подготовка:
### Шаги для настройки NFS сервера:
1. Установка необходимые пакеты для NFS сервера.
    ```sh
    sudo apt update
    sudo apt install nfs-kernel-server
    ```
2. Настройка экспорта директории.
    ```sh
    sudo mkdir -p /srv/nfs_share
    sudo nano /etc/exports
    
    # Добавить строку
    /srv/nfs_share   *(rw,sync,no_subtree_check)
    ```
3. Применение настроек и запуск службы.
    ```sh
    sudo exportfs -a
    sudo systemctl restart nfs-kernel-server
    ```
### Шаги для настройки клиента:
1. Установка пакетов NFS клиента.
    ```sh
    sudo apt update
    sudo apt install nfs-common
    ```
2. Создать каталог `/mnt/nfs`.
    ```sh
    sudo mkdir /mnt/nfs
    ```

## Шаги для воспроизведения
1. Подключить NFS ресурс на клиентскую машину.
    ```sh
    sudo mount -t nfs <NFS_SERVER>:/srv/nfs_share /mnt/nfs
    ```
2. Перейти в примонтированную директорию на клиенте:
    ```sh
    cd /mnt/nfs
    ```
3. Отключить NFS ресурс на сервере.
    ```sh
    sudo systemctl stop nfs-kernel-server
    ```
4. На клиентской машине выполнить команду:
    ```sh
    cd ..
    ```
5. Вернуться обратно в каталог `/mnt/nfs`.
    ```sh
    cd -
    ```


### Ожидаемый результат
Оболочка должна корректно перейти в каталог `/mnt/nfs` и каталог должен быть пустым.

### Фактический результат
Оболочка перестает отвечать и зависает. Закрыть ее через стандартные методы невозможно, только убив процесс по PID.

## Дополнительные шаги для воспроизведения проблемы
1. После выполнения шага 4, открыть новый терминал на клиентской машине.
2. Попытаться получить доступ к каталогу `/mnt/nfs`:
    ```sh
    cd /mnt/nfs
    ```
3. Либо попытаться использовать автозаполнение в оболочке для получения имен файлов в каталоге `/mnt/nfs`.
4. Либо попытаться войти в каталог через Midnight Commander (MC).

### Ожидаемый результат
Каталог `/mnt/nfs` должен открыться без проблем, автозаполнение должно работать корректно, MC должен позволять перейти в пустой каталог.

### Фактический результат
Новый терминал также зависает, как при попытке доступа к каталогу `/mnt/nfs`, так и при использовании автозаполнения или при входе через MC.

## Влияние
Проблема приводит к недоступности оболочки и терминалов при работе с отключенными NFS ресурсами, что существенно влияет на производительность и работу пользователей, использующих NFS ресурсы. Так же если пользователь осуществляем работу с документами находящиеся на примонтированом NFS ресурсе, то после отключения сервера подобное поведение может нарушить целостность внесенных изменений в документ.

## Среда
- Клиентская ОС: [Astra Linux SE 1.6 (Smolensk), версия ядра: 4.15.3-1-generic]
- Серверная ОС: [Astra Linux SE 1.6 (Smolensk), версия ядра: 4.15.3-1-generic]
- Версия NFS сервера: [1:1.3.4-2.1]
- Версия NFS клиента: [1:1.3.4-2.1]

## Логи и Дополнительная информация
Приложил лог собранный с NFS клиента `nfs-client` [nfs_syslog.log](task3/src/nfs_syslog.log), в котором видны попытки клиента получить доступ к серверу.
